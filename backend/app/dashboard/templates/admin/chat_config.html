{% extends "base.html" %}

{% block title %}Chat Config - MindRouter2{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        {% set active = "chat_config" %}
        {% include "admin/_sidebar.html" %}

        <div class="col-md-10 py-3">
            <h1><i class="bi bi-chat-square-text"></i> Chat Configuration</h1>
            <p class="text-muted">Configure which models appear by default in the chat dropdown and set the default model.</p>

            {% if success %}
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                {% if success == 'default_updated' %}Default model updated.
                {% elif success == 'core_updated' %}Core models updated.
                {% else %}{{ success }}{% endif %}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endif %}
            {% if error %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                Error: {{ error }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endif %}

            <div class="row g-4">
                <!-- Default Model -->
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header"><h5 class="mb-0">Default Model</h5></div>
                        <div class="card-body">
                            <p class="text-muted small">The model pre-selected when a user opens the chat. Falls back to the first available model if this one is offline.</p>
                            <form method="post" action="/admin/chat-config">
                                <input type="hidden" name="action" value="set_default">
                                <div class="mb-3">
                                    <select class="form-select" name="default_model">
                                        <option value="">(none)</option>
                                        {% for m in available_models %}
                                        <option value="{{ m }}" {% if m == default_model %}selected{% endif %}>{{ m }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary btn-sm">Save Default</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Core Models -->
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header"><h5 class="mb-0">Core Models</h5></div>
                        <div class="card-body">
                            <p class="text-muted small">Checked models appear by default in the chat dropdown. Users can reveal the full list with the "More models" checkbox. If no core models are online, all models are shown.</p>
                            <form method="post" action="/admin/chat-config">
                                <input type="hidden" name="action" value="set_core_models">
                                {% if available_models %}
                                <div class="mb-3" style="max-height: 300px; overflow-y: auto;">
                                    {% for m in available_models %}
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="core_models" value="{{ m }}" id="core_{{ loop.index }}"
                                               {% if m in core_models %}checked{% endif %}>
                                        <label class="form-check-label" for="core_{{ loop.index }}">{{ m }}</label>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% else %}
                                <p class="text-muted">No healthy backends with models currently online.</p>
                                {% endif %}
                                <button type="submit" class="btn btn-primary btn-sm">Save Core Models</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
