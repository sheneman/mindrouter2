# MindRouter2 Environment Configuration

# =============================================================================
# DATABASE
# =============================================================================
DATABASE_URL=mysql+pymysql://mindrouter:mindrouter_password@localhost:3306/mindrouter
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=10

# =============================================================================
# REDIS (Optional - for rate limiting and caching)
# =============================================================================
REDIS_URL=redis://localhost:6379/0

# =============================================================================
# SECURITY
# =============================================================================
# Generate with: python -c "import secrets; print(secrets.token_hex(32))"
SECRET_KEY=your-secret-key-change-in-production
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=24
SESSION_COOKIE_NAME=mindrouter_session
SESSION_COOKIE_SECURE=false
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=lax

# API key hash settings
API_KEY_HASH_ALGORITHM=argon2

# =============================================================================
# ARTIFACT STORAGE
# =============================================================================
ARTIFACT_STORAGE_PATH=/data/artifacts
ARTIFACT_MAX_SIZE_MB=50
ARTIFACT_RETENTION_DAYS=365

# =============================================================================
# QUOTAS AND LIMITS
# =============================================================================
# Default monthly token budget for new users
DEFAULT_TOKEN_BUDGET_STUDENT=100000
DEFAULT_TOKEN_BUDGET_STAFF=500000
DEFAULT_TOKEN_BUDGET_FACULTY=1000000

# Rate limits
DEFAULT_RPM_STUDENT=30
DEFAULT_RPM_STAFF=60
DEFAULT_RPM_FACULTY=120
DEFAULT_RPM_ADMIN=1000

# Max concurrent requests per user
DEFAULT_MAX_CONCURRENT_STUDENT=2
DEFAULT_MAX_CONCURRENT_STAFF=4
DEFAULT_MAX_CONCURRENT_FACULTY=8
DEFAULT_MAX_CONCURRENT_ADMIN=50

# =============================================================================
# SCHEDULER
# =============================================================================
# Fair-share weights by role
SCHEDULER_WEIGHT_STUDENT=1
SCHEDULER_WEIGHT_STAFF=2
SCHEDULER_WEIGHT_FACULTY=3
SCHEDULER_WEIGHT_ADMIN=10

# Rolling window for usage tracking (seconds)
SCHEDULER_FAIRNESS_WINDOW=300

# Big user deprioritization threshold (% of cluster in window)
SCHEDULER_DEPRIORITIZE_THRESHOLD=0.5

# Backend scoring weights
SCHEDULER_SCORE_MODEL_LOADED=100
SCHEDULER_SCORE_LOW_UTILIZATION=50
SCHEDULER_SCORE_SHORT_QUEUE=30
SCHEDULER_SCORE_HIGH_THROUGHPUT=20

# =============================================================================
# BACKEND REGISTRY
# =============================================================================
# Polling interval for backend capability refresh (seconds)
BACKEND_POLL_INTERVAL=30

# Health check timeout (seconds)
BACKEND_HEALTH_TIMEOUT=5

# Consecutive failures before marking unhealthy
BACKEND_UNHEALTHY_THRESHOLD=3

# =============================================================================
# REQUEST HANDLING
# =============================================================================
# Maximum request body size (bytes)
MAX_REQUEST_SIZE=52428800

# Default timeout for backend requests (seconds)
BACKEND_REQUEST_TIMEOUT=300

# Retry settings
BACKEND_RETRY_ATTEMPTS=2
BACKEND_RETRY_BACKOFF=1.0

# Structured output validation
STRUCTURED_OUTPUT_RETRY_ON_INVALID=true

# =============================================================================
# LOGGING
# =============================================================================
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_FILE=/var/log/mindrouter/app.log

# Audit logging
AUDIT_LOG_ENABLED=true
AUDIT_LOG_PROMPTS=true
AUDIT_LOG_RESPONSES=true

# =============================================================================
# OBSERVABILITY
# =============================================================================
METRICS_ENABLED=true
METRICS_PREFIX=mindrouter

# Tracing (optional)
OTEL_ENABLED=false
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317

# =============================================================================
# DEVELOPMENT
# =============================================================================
DEBUG=false
RELOAD=false
CORS_ORIGINS=["http://localhost:3000","http://localhost:8000"]

# =============================================================================
# TOKENIZER
# =============================================================================
# Default tokenizer for token estimation when backend doesn't report usage
DEFAULT_TOKENIZER=cl100k_base
